<div class="wizard-container">
  <!-- Optional: Step Indicators -->
  <div class="step-indicators">
    <div class="step-indicator" [class.active]="currentStep === 1" [class.completed]="isStepValid(1) && currentStep > 1">1</div>
    <div class="step-indicator" [class.active]="currentStep === 2" [class.completed]="isStepValid(2) && currentStep > 2">2</div>
    <div class="step-indicator" [class.active]="currentStep === 3" [class.completed]="isStepValid(3) && wizardForm.valid">3</div>
  </div>

  <h2>Update Wizard - Step {{ currentStep }}</h2>

  <form [formGroup]="wizardForm" (ngSubmit)="onSubmit()">
    <!-- Section 1 -->
    <div *ngIf="isStepActive(1)" formGroupName="section1">
      <h3>Section 1: Personal Information</h3>
      <div>
        <label for="field1_1">Field 1.1:</label>
        <input id="field1_1" formControlName="field1_1" type="text">
        <div *ngIf="wizardForm.get('section1.field1_1').invalid && (wizardForm.get('section1.field1_1').dirty || wizardForm.get('section1.field1_1').touched)" class="error">
          <span *ngIf="wizardForm.get('section1.field1_1').errors?.required">Field 1.1 is required.</span>
        </div>
      </div>
      <div>
        <label for="field1_2">Field 1.2:</label>
        <input id="field1_2" formControlName="field1_2" type="text">
        <div *ngIf="wizardForm.get('section1.field1_2').invalid && (wizardForm.get('section1.field1_2').dirty || wizardForm.get('section1.field1_2').touched)" class="error">
          <span *ngIf="wizardForm.get('section1.field1_2').errors?.required">Field 1.2 is required.</span>
        </div>
      </div>
    </div>

    <!-- Section 2 -->
    <div *ngIf="isStepActive(2)" formGroupName="section2">
      <h3>Section 2: Contact Details</h3>
      <div>
        <label for="field2_1">Field 2.1:</label>
        <input id="field2_1" formControlName="field2_1" type="text">
        <div *ngIf="wizardForm.get('section2.field2_1').invalid && (wizardForm.get('section2.field2_1').dirty || wizardForm.get('section2.field2_1').touched)" class="error">
          <span *ngIf="wizardForm.get('section2.field2_1').errors?.required">Field 2.1 is required.</span>
        </div>
      </div>
      <div>
        <label for="field2_2">Field 2.2:</label>
        <input id="field2_2" formControlName="field2_2" type="text">
        <div *ngIf="wizardForm.get('section2.field2_2').invalid && (wizardForm.get('section2.field2_2').dirty || wizardForm.get('section2.field2_2').touched)" class="error">
          <span *ngIf="wizardForm.get('section2.field2_2').errors?.required">Field 2.2 is required.</span>
        </div>
      </div>
    </div>

    <!-- Section 3 -->
    <div *ngIf="isStepActive(3)" formGroupName="section3">
      <h3>Section 3: Confirmation</h3>
      <div>
        <label for="field3_1">Field 3.1:</label>
        <input id="field3_1" formControlName="field3_1" type="text">
        <div *ngIf="wizardForm.get('section3.field3_1').invalid && (wizardForm.get('section3.field3_1').dirty || wizardForm.get('section3.field3_1').touched)" class="error">
          <span *ngIf="wizardForm.get('section3.field3_1').errors?.required">Field 3.1 is required.</span>
        </div>
      </div>
      <div>
        <label for="field3_2">Field 3.2:</label>
        <input id="field3_2" formControlName="field3_2" type="text">
        <div *ngIf="wizardForm.get('section3.field3_2').invalid && (wizardForm.get('section3.field3_2').dirty || wizardForm.get('section3.field3_2').touched)" class="error">
          <span *ngIf="wizardForm.get('section3.field3_2').errors?.required">Field 3.2 is required.</span>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="navigation-buttons">
      <button type="button" (click)="previousStep()" *ngIf="currentStep > 1">Previous</button>
      <!-- Placeholder for Previous button to maintain layout if needed, or adjust styling -->
      <span *ngIf="currentStep === 1"></span>

      <button type="button" (click)="nextStep()" *ngIf="currentStep < 3" [disabled]="currentSectionForm?.invalid">Next</button>

      <button type="submit" *ngIf="currentStep === 3" [disabled]="wizardForm.get('section3').invalid">Submit</button>
    </div>
  </form>

  <!-- Debugging form state -->
  <!--
  <pre>Form Value: {{ wizardForm.value | json }}</pre>
  <pre>Form Status: {{ wizardForm.status | json }}</pre>
  <pre>Current Step: {{ currentStep }}</pre>
  <pre>Section 1 Valid: {{ wizardForm.get('section1').valid }}</pre>
  <pre>Section 2 Valid: {{ wizardForm.get('section2').valid }}</pre>
  <pre>Section 3 Valid: {{ wizardForm.get('section3').valid }}</pre>
  <pre>Current Section Form Valid: {{ currentSectionForm?.valid }} </pre>
  -->
</div>
